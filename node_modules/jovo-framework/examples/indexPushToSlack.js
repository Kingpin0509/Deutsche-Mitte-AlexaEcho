'use strict';

const webhook = require('../index').Webhook;

const Slack = require('slack-node');

const webhookUri = 'https://hooks.slack.com/services/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';

const slack = new Slack();
slack.setWebhook(webhookUri);


webhook.listen(3000, function() {
    console.log('Example server listening on port 3000!');
});

const app = require('../index').Jovo;

app.setConfig({
    requestLogging: true,
    responseLogging: true,

    userMetaData: {
        requestHistorySize: 10,
        devices: true,
    },
    slack: {
        webhook: '',
        channel: '',
        username: '',
    },
});

// listen for post requests
webhook.post('/webhook', function(req, res) {
    app.handleRequest(req, res, handlers);
    app.execute();
});


const handlers = {

    'LAUNCH': function() {
        app.toIntent('HelloWorldIntent');
    },

    'HelloWorldIntent': function() {
        slack.webhook({
            channel: '#random',
            username: 'webhookbot',
            text: 'LAUNCH',
        }, function(err, response) {
            console.log(response);
        });
    },
};


